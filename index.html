<!doctype html>
<html lang="en">

<head>

</head>

<body>
	<div class="table-coin">
		<h1>POLONIEX</h1>
		<table>
			<tr>
				<td id="coin-name">Coin name</td>
				<td id="coin-price">Price</td>
				<td id="coin-24High">24h High</td>
				<td id="coin-24Low">24h Low</td>
				<td id="coin-24Percent">Percent</td>
			</tr>
			<tr>
				<td id="coin-name"><label>DOGE </label></td>
				<td id="coin-price"><span id="BTC_DOGE"></span></td>
				<td id="coin-24High"><span id="24HighBTC_DOGE"></span></td>
				<td id="coin-24Low"><span id="24LowBTC_DOGE"></span></td>
				<td id="coin-24Percent"><span id="percentBTC_DOGE"></span></td>
			</tr>
			<tr>
				<td id="coin-name"><label>BCN </label></td>
				<td id="coin-price"><span id="BTC_BCN"></span></td>
				<td id="coin-24High"><span id="24HighBTC_BCN"></span></td>
				<td id="coin-24Low"><span id="24LowBTC_BCN"></span></td>
				<td id="coin-24Percent"><span id="percentBTC_BCN"></span></td>
			</tr>
			<tr>
				<td id="coin-name"><label>SC </label></td>
				<td id="coin-price"><span id="BTC_SC"></span></td>
				<td id="coin-24High"><span id="24HighBTC_SC"></span></td>
				<td id="coin-24Low"><span id="24LowBTC_SC"></span></td>
				<td id="coin-24Percent"><span id="percentBTC_SC"></span></td>
			</tr>
			<tr>
				<td id="coin-name"><label>DGB </label></td>
				<td id="coin-price"><span id="BTC_DGB"></span></td>
				<td id="coin-24High"><span id="24HighBTC_DGB"></span></td>
				<td id="coin-24Low"><span id="24LowBTC_DGB"></span></td>
				<td id="coin-24Percent"><span id="percentBTC_DGB"></span></td>
			</tr>
			<tr>
				<td id="coin-name"><label>STR </label></td>
				<td id="coin-price"><span id="BTC_STR"></span></td>
				<td id="coin-24High"><span id="24HighBTC_STR"></span></td>
				<td id="coin-24Low"><span id="24LowBTC_STR"></span></td>
				<td id="coin-24Percent"><span id="percentBTC_STR"></span></td>
			</tr>
			<tr>
				<td id="coin-name"><label>XRP </label></td>
				<td id="coin-price"><span id="BTC_XRP"></span></td>
				<td id="coin-24High"><span id="24HighBTC_XRP"></span></td>
				<td id="coin-24Low"><span id="24LowBTC_XRP"></span></td>
				<td id="coin-24Percent"><span id="percentBTC_XRP"></span></td>
			</tr>
			<tr>
				<td id="coin-name"><label>FLDC </label></td>
				<td id="coin-price"><span id="BTC_FLDC"></span></td>
				<td id="coin-24High"><span id="24HighBTC_FLDC"></span></td>
				<td id="coin-24Low"><span id="24LowBTC_FLDC"></span></td>
				<td id="coin-24Percent"><span id="percentBTC_FLDC"></span></td>
			</tr>
			<tr>
				<td id="coin-name"><label>POT </label></td>
				<td id="coin-price"><span id="BTC_POT"></span></td>
				<td id="coin-24High"><span id="24HighBTC_POT"></span></td>
				<td id="coin-24Low"><span id="24LowBTC_POT"></span></td>
				<td id="coin-24Percent"><span id="percentBTC_POT"></span></td>
			</tr>
			<tr>
				<td id="coin-name"><label>GRC </label></td>
				<td id="coin-price"><span id="BTC_GRC"></span></td>
				<td id="coin-24High"><span id="24HighBTC_GRC"></span></td>
				<td id="coin-24Low"><span id="24LowBTC_GRC"></span></td>
				<td id="coin-24Percent"><span id="percentBTC_GRC"></span></td>
			</tr>
			<tr>
				<td id="coin-name"><label>BURST </label></td>
				<td id="coin-price"><span id="BTC_BURST"></span></td>
				<td id="coin-24High"><span id="24HighBTC_BURST"></span></td>
				<td id="coin-24Low"><span id="24LowBTC_BURST"></span></td>
				<td id="coin-24Percent"><span id="percentBTC_BURST"></span></td>
			</tr>
		</table>
	</div>
	<div class="table-coin">
		<h1>BITTREX</h1>
		<table>
			<tr>
				<td id="coin-name">Coin name</td>
				<td id="coin-price">Price</td>
				<td id="coin-24High">24h High</td>
				<td id="coin-24Low">24h Low</td>
				<td id="coin-24Percent">Percent</td>
			</tr>
			<tr>
				<td id="coin-name"><label>8-BIT</label></td>
				<td id="coin-price"><span id="BTC-8BIT"></span></td>
				<td id="coin-24High"><span id="24HighBTC-8BIT"></span></td>
				<td id="coin-24Low"><span id="24LowBTC-8BIT"></span></td>
				<td id="coin-24Percent"><span id="percentBTC-8BIT"></span></td>		
			</tr>
			<tr>
				<td id="coin-name"><label>FLDC</label></td>
				<td id="coin-price"><span id="BTC-FLDC"></span></td>
				<td id="coin-24High"><span id="24HighBTC-FLDC"></span></td>
				<td id="coin-24Low"><span id="24LowBTC-FLDC"></span></td>
				<td id="coin-24Percent"><span id="percentBTC-FLDC"></span></td>		
			</tr>
			<tr>
				<td id="coin-name"><label>XVG</label></td>
				<td id="coin-price"><span id="BTC-XVG"></span></td>
				<td id="coin-24High"><span id="24HighBTC-XVG"></span></td>
				<td id="coin-24Low"><span id="24LowBTC-XVG"></span></td>
				<td id="coin-24Percent"><span id="percentBTC-XVG"></span></td>		
			</tr>
			<tr>
				<td id="coin-name"><label>NXT</label></td>
				<td id="coin-price"><span id="BTC-NXT"></span></td>
				<td id="coin-24High"><span id="24HighBTC-NXT"></span></td>
				<td id="coin-24Low"><span id="24LowBTC-NXT"></span></td>
				<td id="coin-24Percent"><span id="percentBTC-NXT"></span></td>		
			</tr>
			<tr>
				<td id="coin-name"><label>THC</label></td>
				<td id="coin-price"><span id="BTC-THC"></span></td>
				<td id="coin-24High"><span id="24HighBTC-THC"></span></td>
				<td id="coin-24Low"><span id="24LowBTC-THC"></span></td>
				<td id="coin-24Percent"><span id="percentBTC-THC"></span></td>		
			</tr>
			<tr>
				<td id="coin-name"><label>RDD</label></td>
				<td id="coin-price"><span id="BTC-RDD"></span></td>
				<td id="coin-24High"><span id="24HighBTC-RDD"></span></td>
				<td id="coin-24Low"><span id="24LowBTC-RDD"></span></td>
				<td id="coin-24Percent"><span id="percentBTC-RDD"></span></td>		
			</tr>
			<tr>
				<td id="coin-name"><label>MYR</label></td>
				<td id="coin-price"><span id="BTC-MYR"></span></td>
				<td id="coin-24High"><span id="24HighBTC-MYR"></span></td>
				<td id="coin-24Low"><span id="24LowBTC-MYR"></span></td>
				<td id="coin-24Percent"><span id="percentBTC-MYR"></span></td>		
			</tr>
			<tr>
				<td id="coin-name"><label>SEC</label></td>
				<td id="coin-price"><span id="BTC-SEC"></span></td>
				<td id="coin-24High"><span id="24HighBTC-SEC"></span></td>
				<td id="coin-24Low"><span id="24LowBTC-SEC"></span></td>
				<td id="coin-24Percent"><span id="percentBTC-SEC"></span></td>		
			</tr>
			<tr>
				<td id="coin-name"><label>ABY</label></td>
				<td id="coin-price"><span id="BTC-ABY"></span></td>
				<td id="coin-24High"><span id="24HighBTC-ABY"></span></td>
				<td id="coin-24Low"><span id="24LowBTC-ABY"></span></td>
				<td id="coin-24Percent"><span id="percentBTC-ABY"></span></td>		
			</tr>
			<tr>
				<td id="coin-name"><label>BURST </label></td>
				<td id="coin-price"><span id="BTC-BURST"></span></td>
				<td id="coin-24High"><span id="24HighBTC-BURST"></span></td>
				<td id="coin-24Low"><span id="24LowBTC-BURST"></span></td>
				<td id="coin-24Percent"><span id="percentBTC-BURST"></span></td>
			</tr>
		</table>
	</div>
	<div class="table-trade-asks" style="width:50%;float:left">
		<h1 id="title-typecoin" style="padding:10px"></h1>
		<h1 style="padding:10px">Bán Coin</h1>
		<table id="table-trade-ob-demo">
			<tr>
				<td>Giá mua</td>
				<td>Số lượng coin</td>
				<td>Tổng giá(BTC)</td>
			</tr>
		</table>
	</div>
	<div class="table-trade-bids" style="width:50%;float:left">
		<h1 style="padding:10px">Bán Coin</h1>
		<table id="table-trade-ob-demo-bid">
			<tr>
				<td>Giá bán</td>
				<td>Số lượng coin</td>
				<td>Tổng giá(BTC)</td>
			</tr>
		</table>
	</div>
	<h1 id="message"></h1>
	
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
	<script src="/socket.io/socket.io.js"></script>
</body>

</html>

<script>  
	$( document ).ready(function() {
	    $('tr').on('click', function(e){
	    	var key = $(e.target).closest('tr').find('td#coin-price').find('span').attr('id');
	    	if (typeof(key) != "undefined") {
	    		if (key.indexOf("-") > 0) {
	    			$('#title-typecoin').text("BITTREX " + key);
	    			console.log("bittrex");
		    	} else if(key.indexOf("_") > 0) {
		    		$('#title-typecoin').text("POLONIEX " + key);
		    		var dataTradeOB = {
				    	currencyPair: key
	    			}
	    			$.ajax({
					    url: "/tradeOB",
					    type: "POST",
					    dataType: "json",
			  			contentType: "application/json", 
					    data: JSON.stringify(dataTradeOB),
					    success: function (response) {
					    	var data = JSON.parse(response);
					    	var askList = data.asks;
					    	var bidList = data.bids;
					    	addTableTrade(askList,bidList);
					    },
				        error: function(error) {
				            console.log("some error in fetching the notifications");
				        }
					});
		    	} else {
		    		console.log("Error");
		    	}
	    	} else {
	    		console.log("Click ở đó không được gì đâu");
	    	}	    	
	    });
	});
    var socket = io();
    socket.on('connect', function(data) {
        socket.emit('join', 'Hello World from client');
    });	

    socket.on('messages', function(data) {
		if(data && $('#' +data[0])){
			var price = data[1];
			var currentPrice = parseFloat($('#'+data[0]).text());
			if (price != currentPrice) {
				changeColor(data[0], price, currentPrice);		
			}			
			$('#' +data[0]).text(price);
			var percent = parseFloat(data[4])*100;
			if (percent <0) {
				$('#percent'+data[0]).css('color','red');
			} else {
				$('#percent'+data[0]).css('color','green');
			}
			$('#24High' +data[0]).text(data[8]);	
			$('#24Low' +data[0]).text(data[9]);	
			$('#percent' +data[0]).text(percent.toString().substring(0,4)+'%');
		}
    });
    socket.on('tradeCoin',function(data){
	    socket.emit('BTC_XMR', data);
	    // var object = data;
	    // console.log(object);
	    // var length = object.length;
	    // console.log(length);
    });
	
    var sendMessage = function(data){
		socket.emit('sendMessages', data);
	};
	
    socket.on('broadcastMessages', function(data) {
		$('#message').text(data);
    });
    
    socket.on('bittrexMessages',function(data){
    	if(data && $('#' +data.MarketName)){
    		var priceBit = parseFloat(data.Last).toFixed(8);
    		var currentPriceBit = parseFloat($('#'+data.MarketName).text());
    		if (priceBit != currentPriceBit) {
    			changeColor(data.MarketName, priceBit,currentPriceBit);	
    		}
			$('#' +data.MarketName).text(priceBit);
			var high = parseFloat(data.High).toFixed(8);
			var low = parseFloat(data.Low).toFixed(8);
			$('#24High' +data.MarketName).text(high);	
			$('#24Low' +data.MarketName).text(low);	
		}
    });
    function changeColor(element, price, currentPrice) {
			var element = $('#'+element).parent();
			var elementCoinName = element.parent().children('td:first');
			if (price > currentPrice) {
				element.css('background-color','green');
				elementCoinName.css('background-color','green');
				setTimeout(function(){
					element.css('background-color','white');
					elementCoinName.css('background-color','white');
				},700);
			} else if(price < currentPrice){
				element.css('background-color','#FFA500');
				elementCoinName.css('background-color','#FFA500');
				setTimeout(function(){
					element.css('background-color','white');
					elementCoinName.css('background-color','white');
				},700);
			}
    }
    function addTableTrade(askList, bidList) {
    	$("#table-trade-ob-demo").find("tr:gt(0)").remove();
    	$(function() {
    		var totalBTC_asks = 0;
		    $.each(askList, function(i, item) {
		    	totalBTC += parseFloat(item[0])*parseFloat(item[1]);
		        var $tr = $('<tr>').append(
		            $('<td>').text(parseFloat(item[0]).toFixed(8)),
		            $('<td>').text(parseFloat(item[1]).toFixed(4)),
		            $('<td>').text(totalBTC_asks.toFixed(4))
		        ).appendTo('#table-trade-ob-demo');
		    });
		    $.each(bidList, function(i, item) {
		    	totalBTC_bids += parseFloat(item[0])*parseFloat(item[1]);
		        var $tr = $('<tr>').append(
		            $('<td>').text(parseFloat(item[0]).toFixed(8)),
		            $('<td>').text(parseFloat(item[1]).toFixed(4)),
		            $('<td>').text(totalBTC_bids.toFixed(4))
		        ).appendTo('#table-trade-ob-demo-bid');
		    });
		});
    }

</script>
<style>
.table-coin {
	width: 50%;
	float:left;
}
.table-coin #coin-name {
	width:100px;
	text-align: center;
	font-weight: 800;	
}
.table-coin #coin-price {
	padding:0px 10px;
	text-align: center;
}
.table-coin #coin-24High {
	padding:0px 10px;
	text-align: center;
}
.table-coin #coin-24Low {
	padding:0px 10px;
	text-align: center;
}
.table-coin #coin-24Percent {
	padding:0px 10px;
	text-align: center;
}
.table-coin tr td {
	border: solid black 1px;
}
.table-coin tr:first-child td{
	padding: 10px;
}
</style>
